# Render Blueprint for Complete Scholara Application
# Deploys all services for school project evaluation

services:
  # PostgreSQL Database
  - type: pserv
    name: scholara-postgres
    plan: starter
    envVars:
      - key: POSTGRES_DB
        value: scholara_db
      - key: POSTGRES_USER
        value: postgres
      - key: POSTGRES_PASSWORD
        value: postgres
    diskSizeGB: 10

  # MySQL Database for Student Service
  - type: pserv
    name: scholara-mysql
    plan: starter
    envVars:
      - key: MYSQL_ROOT_PASSWORD
        value: password
      - key: MYSQL_DATABASE
        value: scholara_students
      - key: MYSQL_USER
        value: scholara
      - key: MYSQL_PASSWORD
        value: scholara123
    diskSizeGB: 10

  # Auth Service (Spring Boot)
  - type: web
    name: scholara-auth-service
    runtime: docker
    plan: starter
    dockerfilePath: backend/auth-service/Dockerfile
    dockerContext: backend/auth-service
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: docker
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://scholara-postgres:5432/scholara_db
      - key: SPRING_DATASOURCE_USERNAME
        value: postgres
      - key: SPRING_DATASOURCE_PASSWORD
        value: postgres
    healthCheckPath: /actuator/health
    port: 8085

  # Student Service (Spring Boot)
  - type: web
    name: scholara-student-service
    runtime: docker
    plan: starter
    dockerfilePath: backend/student-service/Dockerfile
    dockerContext: backend/student-service
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: docker
      - key: SPRING_DATASOURCE_URL
        value: jdbc:mysql://scholara-mysql:3306/scholara_students?createDatabaseIfNotExist=true&useSSL=false&serverTimezone=UTC
      - key: SPRING_DATASOURCE_USERNAME
        value: root
      - key: SPRING_DATASOURCE_PASSWORD
        value: password
    healthCheckPath: /actuator/health
    port: 8081

  # Course Service (Django)
  - type: web
    name: scholara-course-service
    runtime: docker
    plan: starter
    dockerfilePath: backend/course-service/Dockerfile
    dockerContext: backend/course-service
    envVars:
      - key: DEBUG
        value: "False"
      - key: DB_NAME
        value: scholara_db
      - key: DB_USER
        value: postgres
      - key: DB_PASSWORD
        value: postgres
      - key: DB_HOST
        value: scholara-postgres
      - key: DB_PORT
        value: "5432"
    healthCheckPath: /health/
    port: 8082

  # API Gateway (Spring Cloud Gateway)
  - type: web
    name: scholara-api-gateway
    runtime: docker
    plan: starter
    dockerfilePath: backend/api-gateway/Dockerfile
    dockerContext: backend/api-gateway
    envVars:
      - key: SERVER_PORT
        value: "8084"
      - key: STUDENT_SERVICE_URL
        value: http://scholara-student-service:8081
      - key: COURSE_SERVICE_URL
        value: http://scholara-course-service:8082
      - key: AUTH_SERVICE_URL
        value: http://scholara-auth-service:8085
    healthCheckPath: /actuator/health
    port: 8084

  # Frontend (React/Vite)
  - type: web
    name: scholara-frontend
    runtime: docker
    plan: starter
    dockerfilePath: frontend/Dockerfile
    dockerContext: frontend
    envVars:
      - key: VITE_API_BASE_URL
        value: http://scholara-api-gateway:8084/api
    healthCheckPath: /
    port: 5173